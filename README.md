# Лабораторная 3 
## Система электронной почты. Сервер.
## Инструкция по использованию
Проект написаны на Kotlin JVM и требуют JDK 1.8 для сборки и JRE 1.8 для работы. Сборка осуществляется через систему Gradle. Дополнительно скачивать Gradle не нужно. В репозитории хранятся скрипты Gradle Wrapper, которые могут скачать нужную версию Gradle в случае необходимости. 
## Описание используемого протокола

Все пакеты, состоят из двух частей:

##### Первый байт - число. Если этот пакет от клиента серверу - это команда. Если это пакет от сервера клиенту - результат выполнения запроса.

Возможные значения:

От клиента серверу (команды):

 - 0 - Авторизация клиента на сервере.
 - 1 - Отправка письма.
 - 2 - Запрос на получение всех имеющихся писем.
 - 3 - Удаление с почтового сервера одного письма.
 - 4 - Выход с сервера.
 
От сервера клиенту (результат выполнения запроса клиента):

 - 0 - Успешный обработка запроса клиента.
 - 1 - Ошибка. 
 
##### Вторая часть пакета - строка, в которой содержится информация в формате Json.

После отправки любой команды из списка выше на сервер, сервер отвечает пакетом, который содержит команду с результатом выполнения запроса клиента и сообщение в формате json с информацией о выполненнии запроса:

`
{
  "message": "Success!"
}
`

* Авторизация - для авторизации нужно послать на сервер пакет с командой 0 и свой email в формате json:

`
{
  "name": "example@example.example"
}
`

Поддерживаются форматы email по стандарту RFC 5321.

`
{
  "message": "Incorrect Email"
}
`

В случае успеха вернется приветственное сообщение.

* Отправка письма

Письма обрабатываются в формате json:

`
{
  "to": "recipient",
  "header": "email's header",
  "content": "email's contenet",
  "time": "dispatch time"
}
`

* Получение всех писем. 

Для получения всех писем нужно передать только команду (2). Письма приходят в формате json:

`
[ 
{ 
  "from": "sender1",
  "to": "recipient1",
  "header": "email's header1",
  "content": "email's contenet1",
  "time": "dispatch time1"
},
{
  "from": "sender2",
  "to": "recipient2",
  "header": "email's header2",
  "content": "email's contenet2",
  "time": "dispatch time2"
}
]
`

* Удаление письма

Для удаление одного пиьсма с сервера нужно передать его id в формате json:
`
{
  "index": 1
}
`

* Выход с сервера

Для выхода с сервера нужно передать только команду (4).

## Реализация сервера
#### Основные возможности:

1) Прослушивание определенного порта
2) Обработка запросов на подключение по этому порту от клиентов
3) Поддержка одновременной работы нескольких почтовых клиентов
через механизм нитей
4) Приём почтового сообщения от одного клиента для другого
5) Хранение электронной почты для клиентов
6) Посылка клиенту почтового сообщения по запросу с последующим
удалением сообщения
7) Посылка клиенту сведений о состоянии постового ящика
8) Обработка запроса на отключение клиента

* Авторизация

При успешной авторизации отправлется приветственное сообщение. Если пользватель авторизуется с некорректным email вернется ошибка с соответствующим сообщением. 
При успешной авторизации клиент запоминается, для сохранения его писем, и писем отправленных ему.

* Отправка письма 

При успешном запросе, клиенту отправляется сообщение с успехом. Если клиентом отправлен неверный формат письма вернется ошибка с соответствующим сообщением. 

* Получение всех писем. 

Отправляются все письма, которые отправил клиент и которые адресованы кленту. 

* Удаление письма

Удаляется пиьсмо с сервера при этом, оно больше не будет появляться при получении всех писем. Если удаляется письмо, которое адресовано клиенту, то у другого клиента (отправителя) оно сохранится.

* Выход с сервера

Обработка запроса на отключение клиента. Отправляется прощальное сообщение. 
